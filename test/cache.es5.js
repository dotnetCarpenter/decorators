"use strict";

var tap = _interopRequireWildcard(require("tap"));

var _cache = _interopRequireDefault(require("../src/cache.es5"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function work(...args) {
  return args.reduce((a, b) => a + Math.random() * b, Math.random());
}

function workWithObject(obj) {
  return work.apply(null, Object.values(obj));
}

tap.test("simple caching", t => {
  t.plan(2);
  const memWork = (0, _cache.default)(work);
  let a = memWork(1);
  let b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
});
tap.test("dyadic caching", t => {
  t.plan(3);
  const memWork = (0, _cache.default)(work);
  let a = memWork(2, 4);
  let b = memWork(2, 4);
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork(2, 4.2);
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork(2, 4);
  t.notEqual(a, b, "a === b should be false");
});
tap.test("triadic caching", t => {
  t.plan(3);
  const memWork = (0, _cache.default)(work);
  let a = memWork(5, 7, 2);
  let b = memWork(5, 7, 2);
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork(1, 4.2, 41);
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork(1, 4.2, 41);
  t.notEqual(a, b, "a === b should be false");
});
tap.test("object caching", t => {
  t.plan(5);
  const memWork = (0, _cache.default)(workWithObject);
  let a = memWork({
    a: 1
  });
  let b = memWork({
    a: 1
  });
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork({
    b: 1
  });
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork({
    a: 1
  });
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  a = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  b = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  a = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  b = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: 100
  });
  t.notEqual(a, b, "a === b should be false)");
});
tap.test("array caching", t => {
  t.plan(3);
  let memWork = (0, _cache.default)(work);
  let a = memWork.apply(null, [1, 2, 3]);
  let b = memWork.apply(null, [1, 2, 3]);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork.apply(null, [1, 2, 3]);
  t.notEqual(a, b, "a === b should be false");
  /** context can NOT be used to transform input **/

  memWork = (0, _cache.default)(work, work);
  a = memWork([1, 2, 3]);
  b = memWork([1, 2, 3]);
  t.notEqual(a, b, "a === b should be false - NaN - context can NOT be used to transform input )");
});
tap.test("context caching (prototype/object)", t => {
  t.plan(6);

  function MyClass() {
    this.work = work;
  }

  MyClass.prototype.execute = function (values) {
    return this.work(values);
  };

  class MyClassSuger {
    constructor() {
      this.work = work;
    }

    execute(values) {
      return this.work(values);
    }

  }

  const myObject = {
    work,

    execute(values) {
      return this.work(values);
    }

  };
  /** prototypal context **/

  const myClass = new MyClass();
  let memWork = (0, _cache.default)(myClass.execute, myClass);
  let a = memWork(1);
  let b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
  /** class prototypal context **/

  const myClassSugar = new MyClassSuger();
  memWork = (0, _cache.default)(myClassSugar.execute, myClassSugar);
  a = memWork(1);
  b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
  /** object context **/

  memWork = (0, _cache.default)(myObject.execute, myObject);
  a = memWork(1);
  b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBOEIsUUFBOUIsQ0FBVjtBQUNBLEVBQUEsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFELENBQVg7QUFDQSxFQUFBLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBRCxDQUFYO0FBRUEsRUFBQSxDQUFDLENBQUMsS0FBRixDQUFRLENBQVIsRUFBVyxDQUFYLEVBQWMsaUNBQWQ7QUFDQSxFQUFBLE9BQU8sQ0FBQyxLQUFSLEdBMURxRCxDQTBEckM7O0FBRWhCLEVBQUEsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFELENBQVg7QUFDQSxFQUFBLENBQUMsQ0FBQyxRQUFGLENBQVcsQ0FBWCxFQUFjLENBQWQsRUFBaUIseUJBQWpCO0FBQ0EsQ0E5REQiLCJmaWxlIjoiY2FjaGUuZXM1LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCJcblxuaW1wb3J0ICogYXMgdGFwIGZyb20gXCJ0YXBcIlxuaW1wb3J0IG1ha2VDYWNoaW5nIGZyb20gXCIuLi9zcmMvY2FjaGUuZXM1XCJcblxuZnVuY3Rpb24gd29yayguLi5hcmdzKSB7IHJldHVybiBhcmdzLnJlZHVjZSgoYSxiKSA9PiBhICsgTWF0aC5yYW5kb20oKSpiLCBNYXRoLnJhbmRvbSgpKSB9XG5mdW5jdGlvbiB3b3JrV2l0aE9iamVjdChvYmopIHsgcmV0dXJuIHdvcmsuYXBwbHkobnVsbCwgT2JqZWN0LnZhbHVlcyhvYmopKSB9XG5cblxudGFwLnRlc3QoXCJzaW1wbGUgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oMilcblxuXHRjb25zdCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrKDEpXG5cdGxldCBiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxufSlcblxudGFwLnRlc3QoXCJkeWFkaWMgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oMylcblxuXHRjb25zdCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrKDIsIDQpXG5cdGxldCBiID0gbWVtV29yaygyLCA0KVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0YiA9IG1lbVdvcmsoMiwgNC4yKVxuXHR0Lm5vdEVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXHRtZW1Xb3JrLmZsdXNoKClcdC8vIGNsZWFycyB0aGUgY2FjaGVcblx0YiA9IG1lbVdvcmsoMiwgNClcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG59KVxuXG50YXAudGVzdChcInRyaWFkaWMgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oMylcblxuXHRjb25zdCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrKDUsIDcsIDIpXG5cdGxldCBiID0gbWVtV29yayg1LCA3LCAyKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0YiA9IG1lbVdvcmsoMSwgNC4yLCA0MSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKDEsIDQuMiwgNDEpXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxufSlcblxudGFwLnRlc3QoXCJvYmplY3QgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oNSlcblxuXHRjb25zdCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29ya1dpdGhPYmplY3QpXG5cdGxldCBhID0gbWVtV29yayh7YToxfSlcblx0bGV0IGIgPSBtZW1Xb3JrKHthOjF9KVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0YiA9IG1lbVdvcmsoe2I6MX0pXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yayh7YToxfSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGEgPSBtZW1Xb3JrKHthOjMsYjoyLGM6NSxkOi0xfSlcblx0YiA9IG1lbVdvcmsoe2E6MyxiOjIsYzo1LGQ6LTF9KVxuXHR0LmVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgdHJ1ZSAoY2FjaGVkKVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRhID0gbWVtV29yayh7YTozLGI6MixjOjUsZDotMX0pXG5cdGIgPSBtZW1Xb3JrKHthOjMsYjoyLGM6NSxkOjEwMH0pXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZSlcIilcbn0pXG5cbnRhcC50ZXN0KFwiYXJyYXkgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oMylcblxuXHRsZXQgbWVtV29yayA9IG1ha2VDYWNoaW5nKHdvcmspXG5cdGxldCBhID0gbWVtV29yay5hcHBseShudWxsLCBbMSwyLDNdKVxuXHRsZXQgYiA9IG1lbVdvcmsuYXBwbHkobnVsbCwgWzEsMiwzXSlcblxuXHR0LmVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgdHJ1ZSAoY2FjaGVkKVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yay5hcHBseShudWxsLCBbMSwyLDNdKVxuXHR0Lm5vdEVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXG5cdC8qKiBjb250ZXh0IGNhbiBOT1QgYmUgdXNlZCB0byB0cmFuc2Zvcm0gaW5wdXQgKiovXG5cdG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrLCB3b3JrKVxuXHRhID0gbWVtV29yayhbMSwyLDNdKVxuXHRiID0gbWVtV29yayhbMSwyLDNdKVxuXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZSAtIE5hTiAtIGNvbnRleHQgY2FuIE5PVCBiZSB1c2VkIHRvIHRyYW5zZm9ybSBpbnB1dCApXCIpXG59KVxuXG50YXAudGVzdChcImNvbnRleHQgY2FjaGluZyAocHJvdG90eXBlL29iamVjdClcIiwgKHQpID0+IHtcblx0dC5wbGFuKDYpXG5cblx0ZnVuY3Rpb24gTXlDbGFzcygpIHtcblx0XHR0aGlzLndvcmsgPSB3b3JrXG5cdH1cblx0TXlDbGFzcy5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uKHZhbHVlcykge1xuXHRcdHJldHVybiB0aGlzLndvcmsodmFsdWVzKVxuXHR9XG5cblx0Y2xhc3MgTXlDbGFzc1N1Z2VyIHtcblx0XHRjb25zdHJ1Y3RvcigpIHtcblx0XHRcdHRoaXMud29yayA9IHdvcmtcblx0XHR9XG5cdFx0ZXhlY3V0ZSh2YWx1ZXMpIHtcblx0XHRcdHJldHVybiB0aGlzLndvcmsodmFsdWVzKVxuXHRcdH1cblx0fVxuXG5cdGNvbnN0IG15T2JqZWN0ID0ge1xuXHRcdHdvcmssXG5cdFx0ZXhlY3V0ZSh2YWx1ZXMpIHtcblx0XHRcdHJldHVybiB0aGlzLndvcmsodmFsdWVzKVxuXHRcdH1cblx0fVxuXG5cdC8qKiBwcm90b3R5cGFsIGNvbnRleHQgKiovXG5cdGNvbnN0IG15Q2xhc3MgPSBuZXcgTXlDbGFzc1xuXHRsZXQgbWVtV29yayA9IG1ha2VDYWNoaW5nKG15Q2xhc3MuZXhlY3V0ZSwgbXlDbGFzcylcblx0bGV0IGEgPSBtZW1Xb3JrKDEpXG5cdGxldCBiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cblx0LyoqIGNsYXNzIHByb3RvdHlwYWwgY29udGV4dCAqKi9cblx0Y29uc3QgbXlDbGFzc1N1Z2FyID0gbmV3IE15Q2xhc3NTdWdlclxuXHRtZW1Xb3JrID0gbWFrZUNhY2hpbmcobXlDbGFzc1N1Z2FyLmV4ZWN1dGUsIG15Q2xhc3NTdWdhcilcblx0YSA9IG1lbVdvcmsoMSlcblx0YiA9IG1lbVdvcmsoMSlcblxuXHR0LmVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgdHJ1ZSAoY2FjaGVkKVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yaygxKVxuXHR0Lm5vdEVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXG5cdC8qKiBvYmplY3QgY29udGV4dCAqKi9cblx0bWVtV29yayA9IG1ha2VDYWNoaW5nKG15T2JqZWN0LmV4ZWN1dGUsIG15T2JqZWN0KVxuXHRhID0gbWVtV29yaygxKVxuXHRiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxufSlcbiJdfQ==