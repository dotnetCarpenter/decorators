"use strict";

var _tap = _interopRequireDefault(require("tap"));

var _cache = _interopRequireDefault(require("../src/cache.es5"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function work(...args) {
  return args.reduce((a, b) => a + Math.random() * b, Math.random());
}

function workWithObject(obj) {
  return work.apply(null, Object.values(obj));
}

_tap.default.test("simple caching", t => {
  t.plan(2);
  const memWork = (0, _cache.default)(work);
  let a = memWork(1);
  let b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
});

_tap.default.test("dyadic caching", t => {
  t.plan(3);
  const memWork = (0, _cache.default)(work);
  let a = memWork(2, 4);
  let b = memWork(2, 4);
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork(2, 4.2);
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork(2, 4);
  t.notEqual(a, b, "a === b should be false");
});

_tap.default.test("triadic caching", t => {
  t.plan(3);
  const memWork = (0, _cache.default)(work);
  let a = memWork(5, 7, 2);
  let b = memWork(5, 7, 2);
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork(1, 4.2, 41);
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork(1, 4.2, 41);
  t.notEqual(a, b, "a === b should be false");
});

_tap.default.test("object caching", t => {
  t.plan(5);
  const memWork = (0, _cache.default)(workWithObject);
  let a = memWork({
    a: 1
  });
  let b = memWork({
    a: 1
  });
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork({
    b: 1
  });
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork({
    a: 1
  });
  t.notEqual(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  a = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  b = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  a = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  b = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: 100
  });
  t.notEqual(a, b, "a === b should be false)");
});

_tap.default.test("array caching", t => {
  t.plan(3);
  let memWork = (0, _cache.default)(work);
  let a = memWork.apply(null, [1, 2, 3]);
  let b = memWork.apply(null, [1, 2, 3]);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork.apply(null, [1, 2, 3]);
  t.notEqual(a, b, "a === b should be false");
  /** context can NOT be used to transform input **/

  memWork = (0, _cache.default)(work, work);
  a = memWork([1, 2, 3]);
  b = memWork([1, 2, 3]);
  t.notEqual(a, b, "a === b should be false - NaN - context can NOT be used to transform input )");
});

_tap.default.test("context caching (prototype/object)", t => {
  t.plan(6);

  function MyClass() {
    this.work = work;
  }

  MyClass.prototype.execute = function (values) {
    return this.work(values);
  };

  class MyClassSuger {
    constructor() {
      this.work = work;
    }

    execute(values) {
      return this.work(values);
    }

  }

  const myObject = {
    work,

    execute(values) {
      return this.work(values);
    }

  };
  /** prototypal context **/

  const myClass = new MyClass();
  let memWork = (0, _cache.default)(myClass.execute, myClass);
  let a = memWork(1);
  let b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
  /** class prototypal context **/

  const myClassSugar = new MyClassSuger();
  memWork = (0, _cache.default)(myClassSugar.execute, myClassSugar);
  a = memWork(1);
  b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
  /** object context **/

  memWork = (0, _cache.default)(myObject.execute, myObject);
  a = memWork(1);
  b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.notEqual(a, b, "a === b should be false");
});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUMsR0FBRyxPQUFPLENBQUMsQ0FBRCxDQUFYO0FBQ0EsRUFBQSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUQsQ0FBWDtBQUVBLEVBQUEsQ0FBQyxDQUFDLEtBQUYsQ0FBUSxDQUFSLEVBQVcsQ0FBWCxFQUFjLGlDQUFkO0FBQ0EsRUFBQSxPQUFPLENBQUMsS0FBUixHQTFEcUQsQ0EwRHJDOztBQUVoQixFQUFBLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBRCxDQUFYO0FBQ0EsRUFBQSxDQUFDLENBQUMsUUFBRixDQUFXLENBQVgsRUFBYyxDQUFkLEVBQWlCLHlCQUFqQjtBQUNBLENBOUREIiwiZmlsZSI6ImNhY2hlLmVzNS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiXG5cbmltcG9ydCB0YXAgZnJvbSBcInRhcFwiXG5pbXBvcnQgbWFrZUNhY2hpbmcgZnJvbSBcIi4uL3NyYy9jYWNoZS5lczVcIlxuXG5mdW5jdGlvbiB3b3JrKC4uLmFyZ3MpIHsgcmV0dXJuIGFyZ3MucmVkdWNlKChhLGIpID0+IGEgKyBNYXRoLnJhbmRvbSgpKmIsIE1hdGgucmFuZG9tKCkpIH1cbmZ1bmN0aW9uIHdvcmtXaXRoT2JqZWN0KG9iaikgeyByZXR1cm4gd29yay5hcHBseShudWxsLCBPYmplY3QudmFsdWVzKG9iaikpIH1cblxuXG50YXAudGVzdChcInNpbXBsZSBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbigyKVxuXG5cdGNvbnN0IG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrKVxuXHRsZXQgYSA9IG1lbVdvcmsoMSlcblx0bGV0IGIgPSBtZW1Xb3JrKDEpXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRtZW1Xb3JrLmZsdXNoKClcdC8vIGNsZWFycyB0aGUgY2FjaGVcblx0YiA9IG1lbVdvcmsoMSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG59KVxuXG50YXAudGVzdChcImR5YWRpYyBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbigzKVxuXG5cdGNvbnN0IG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrKVxuXHRsZXQgYSA9IG1lbVdvcmsoMiwgNClcblx0bGV0IGIgPSBtZW1Xb3JrKDIsIDQpXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRiID0gbWVtV29yaygyLCA0LjIpXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yaygyLCA0KVxuXHR0Lm5vdEVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcbn0pXG5cbnRhcC50ZXN0KFwidHJpYWRpYyBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbigzKVxuXG5cdGNvbnN0IG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrKVxuXHRsZXQgYSA9IG1lbVdvcmsoNSwgNywgMilcblx0bGV0IGIgPSBtZW1Xb3JrKDUsIDcsIDIpXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRiID0gbWVtV29yaygxLCA0LjIsIDQxKVxuXHR0Lm5vdEVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXHRtZW1Xb3JrLmZsdXNoKClcdC8vIGNsZWFycyB0aGUgY2FjaGVcblx0YiA9IG1lbVdvcmsoMSwgNC4yLCA0MSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG59KVxuXG50YXAudGVzdChcIm9iamVjdCBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbig1KVxuXG5cdGNvbnN0IG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrV2l0aE9iamVjdClcblx0bGV0IGEgPSBtZW1Xb3JrKHthOjF9KVxuXHRsZXQgYiA9IG1lbVdvcmsoe2E6MX0pXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRiID0gbWVtV29yayh7YjoxfSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKHthOjF9KVxuXHR0Lm5vdEVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXHRtZW1Xb3JrLmZsdXNoKClcdC8vIGNsZWFycyB0aGUgY2FjaGVcblx0YSA9IG1lbVdvcmsoe2E6MyxiOjIsYzo1LGQ6LTF9KVxuXHRiID0gbWVtV29yayh7YTozLGI6MixjOjUsZDotMX0pXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGEgPSBtZW1Xb3JrKHthOjMsYjoyLGM6NSxkOi0xfSlcblx0YiA9IG1lbVdvcmsoe2E6MyxiOjIsYzo1LGQ6MTAwfSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlKVwiKVxufSlcblxudGFwLnRlc3QoXCJhcnJheSBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbigzKVxuXG5cdGxldCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrLmFwcGx5KG51bGwsIFsxLDIsM10pXG5cdGxldCBiID0gbWVtV29yay5hcHBseShudWxsLCBbMSwyLDNdKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrLmFwcGx5KG51bGwsIFsxLDIsM10pXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cblx0LyoqIGNvbnRleHQgY2FuIE5PVCBiZSB1c2VkIHRvIHRyYW5zZm9ybSBpbnB1dCAqKi9cblx0bWVtV29yayA9IG1ha2VDYWNoaW5nKHdvcmssIHdvcmspXG5cdGEgPSBtZW1Xb3JrKFsxLDIsM10pXG5cdGIgPSBtZW1Xb3JrKFsxLDIsM10pXG5cblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlIC0gTmFOIC0gY29udGV4dCBjYW4gTk9UIGJlIHVzZWQgdG8gdHJhbnNmb3JtIGlucHV0IClcIilcbn0pXG5cbnRhcC50ZXN0KFwiY29udGV4dCBjYWNoaW5nIChwcm90b3R5cGUvb2JqZWN0KVwiLCAodCkgPT4ge1xuXHR0LnBsYW4oNilcblxuXHRmdW5jdGlvbiBNeUNsYXNzKCkge1xuXHRcdHRoaXMud29yayA9IHdvcmtcblx0fVxuXHRNeUNsYXNzLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24odmFsdWVzKSB7XG5cdFx0cmV0dXJuIHRoaXMud29yayh2YWx1ZXMpXG5cdH1cblxuXHRjbGFzcyBNeUNsYXNzU3VnZXIge1xuXHRcdGNvbnN0cnVjdG9yKCkge1xuXHRcdFx0dGhpcy53b3JrID0gd29ya1xuXHRcdH1cblx0XHRleGVjdXRlKHZhbHVlcykge1xuXHRcdFx0cmV0dXJuIHRoaXMud29yayh2YWx1ZXMpXG5cdFx0fVxuXHR9XG5cblx0Y29uc3QgbXlPYmplY3QgPSB7XG5cdFx0d29yayxcblx0XHRleGVjdXRlKHZhbHVlcykge1xuXHRcdFx0cmV0dXJuIHRoaXMud29yayh2YWx1ZXMpXG5cdFx0fVxuXHR9XG5cblx0LyoqIHByb3RvdHlwYWwgY29udGV4dCAqKi9cblx0Y29uc3QgbXlDbGFzcyA9IG5ldyBNeUNsYXNzXG5cdGxldCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcobXlDbGFzcy5leGVjdXRlLCBteUNsYXNzKVxuXHRsZXQgYSA9IG1lbVdvcmsoMSlcblx0bGV0IGIgPSBtZW1Xb3JrKDEpXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRtZW1Xb3JrLmZsdXNoKClcdC8vIGNsZWFycyB0aGUgY2FjaGVcblx0YiA9IG1lbVdvcmsoMSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG5cblxuXHQvKiogY2xhc3MgcHJvdG90eXBhbCBjb250ZXh0ICoqL1xuXHRjb25zdCBteUNsYXNzU3VnYXIgPSBuZXcgTXlDbGFzc1N1Z2VyXG5cdG1lbVdvcmsgPSBtYWtlQ2FjaGluZyhteUNsYXNzU3VnYXIuZXhlY3V0ZSwgbXlDbGFzc1N1Z2FyKVxuXHRhID0gbWVtV29yaygxKVxuXHRiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90RXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cblx0LyoqIG9iamVjdCBjb250ZXh0ICoqL1xuXHRtZW1Xb3JrID0gbWFrZUNhY2hpbmcobXlPYmplY3QuZXhlY3V0ZSwgbXlPYmplY3QpXG5cdGEgPSBtZW1Xb3JrKDEpXG5cdGIgPSBtZW1Xb3JrKDEpXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cblx0YiA9IG1lbVdvcmsoMSlcblx0dC5ub3RFcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG59KVxuIl19