"use strict";

var _tap = _interopRequireDefault(require("tap"));

var _cache = _interopRequireDefault(require("../src/cache.es5"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function work(...args) {
  return args.reduce((a, b) => a + Math.random() * b, Math.random());
}

function workWithObject(obj) {
  return work.apply(null, Object.values(obj));
}

_tap.default.test("simple caching", t => {
  t.plan(2);
  const memWork = (0, _cache.default)(work);
  let a = memWork(1);
  let b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.not(a, b, "a === b should be false");
});

_tap.default.test("dyadic caching", t => {
  t.plan(3);
  const memWork = (0, _cache.default)(work);
  let a = memWork(2, 4);
  let b = memWork(2, 4);
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork(2, 4.2);
  t.not(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork(2, 4);
  t.not(a, b, "a === b should be false");
});

_tap.default.test("triadic caching", t => {
  t.plan(3);
  const memWork = (0, _cache.default)(work);
  let a = memWork(5, 7, 2);
  let b = memWork(5, 7, 2);
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork(1, 4.2, 41);
  t.not(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork(1, 4.2, 41);
  t.not(a, b, "a === b should be false");
});

_tap.default.test("object caching", t => {
  t.plan(5);
  const memWork = (0, _cache.default)(workWithObject);
  let a = memWork({
    a: 1
  });
  let b = memWork({
    a: 1
  });
  t.equal(a, b, "a === b should be true (cached)");
  b = memWork({
    b: 1
  });
  t.not(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  b = memWork({
    a: 1
  });
  t.not(a, b, "a === b should be false");
  memWork.flush(); // clears the cache

  a = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  b = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  a = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: -1
  });
  b = memWork({
    a: 3,
    b: 2,
    c: 5,
    d: 100
  });
  t.not(a, b, "a === b should be false)");
});

_tap.default.test("array caching", t => {
  t.plan(3);
  let memWork = (0, _cache.default)(work);
  let a = memWork.apply(null, [1, 2, 3]);
  let b = memWork.apply(null, [1, 2, 3]);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork.apply(null, [1, 2, 3]);
  t.not(a, b, "a === b should be false");
  /** context can NOT be used to transform input **/

  memWork = (0, _cache.default)(work, work);
  a = memWork([1, 2, 3]);
  b = memWork([1, 2, 3]);
  t.not(a, b, "a === b should be false - NaN - context can NOT be used to transform input )");
});

_tap.default.test("context caching (prototype/object)", t => {
  t.plan(6);

  function MyClass() {
    this.work = work;
  }

  MyClass.prototype.execute = function (values) {
    return this.work(values);
  };

  class MyClassSugar {
    constructor() {
      this.work = work;
    }

    execute(values) {
      return this.work(values);
    }

  }

  const myObject = {
    work,

    execute(values) {
      return this.work(values);
    }

  };
  /** prototypal context **/

  const myClass = new MyClass();
  let memWork = (0, _cache.default)(myClass.execute, myClass);
  let a = memWork(1);
  let b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.not(a, b, "a === b should be false");
  /** class prototypal context **/

  const myClassSugar = new MyClassSugar();
  memWork = (0, _cache.default)(myClassSugar.execute, myClassSugar);
  a = memWork(1);
  b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.not(a, b, "a === b should be false");
  /** object context **/

  memWork = (0, _cache.default)(myObject.execute, myObject);
  a = memWork(1);
  b = memWork(1);
  t.equal(a, b, "a === b should be true (cached)");
  memWork.flush(); // clears the cache

  b = memWork(1);
  t.not(a, b, "a === b should be false");
});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFYO0FBQ0EsRUFBQSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUQsQ0FBWDtBQUVBLEVBQUEsQ0FBQyxDQUFDLEtBQUYsQ0FBUSxDQUFSLEVBQVcsQ0FBWCxFQUFjLGlDQUFkO0FBQ0EsRUFBQSxPQUFPLENBQUMsS0FBUixHQTFEcUQsQ0EwRHJDOztBQUVoQixFQUFBLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBRCxDQUFYO0FBQ0EsRUFBQSxDQUFDLENBQUMsR0FBRixDQUFNLENBQU4sRUFBUyxDQUFULEVBQVkseUJBQVo7QUFDQSxDQTlERCIsImZpbGUiOiJjYWNoZS5lczUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIlxuXG5pbXBvcnQgdGFwIGZyb20gXCJ0YXBcIlxuaW1wb3J0IG1ha2VDYWNoaW5nIGZyb20gXCIuLi9zcmMvY2FjaGUuZXM1XCJcblxuZnVuY3Rpb24gd29yayguLi5hcmdzKSB7IHJldHVybiBhcmdzLnJlZHVjZSgoYSxiKSA9PiBhICsgTWF0aC5yYW5kb20oKSpiLCBNYXRoLnJhbmRvbSgpKSB9XG5mdW5jdGlvbiB3b3JrV2l0aE9iamVjdChvYmopIHsgcmV0dXJuIHdvcmsuYXBwbHkobnVsbCwgT2JqZWN0LnZhbHVlcyhvYmopKSB9XG5cblxudGFwLnRlc3QoXCJzaW1wbGUgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oMilcblxuXHRjb25zdCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrKDEpXG5cdGxldCBiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90KGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcbn0pXG5cbnRhcC50ZXN0KFwiZHlhZGljIGNhY2hpbmdcIiwgKHQpID0+IHtcblx0dC5wbGFuKDMpXG5cblx0Y29uc3QgbWVtV29yayA9IG1ha2VDYWNoaW5nKHdvcmspXG5cdGxldCBhID0gbWVtV29yaygyLCA0KVxuXHRsZXQgYiA9IG1lbVdvcmsoMiwgNClcblxuXHR0LmVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgdHJ1ZSAoY2FjaGVkKVwiKVxuXG5cdGIgPSBtZW1Xb3JrKDIsIDQuMilcblx0dC5ub3QoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yaygyLCA0KVxuXHR0Lm5vdChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG59KVxuXG50YXAudGVzdChcInRyaWFkaWMgY2FjaGluZ1wiLCAodCkgPT4ge1xuXHR0LnBsYW4oMylcblxuXHRjb25zdCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrKDUsIDcsIDIpXG5cdGxldCBiID0gbWVtV29yayg1LCA3LCAyKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0YiA9IG1lbVdvcmsoMSwgNC4yLCA0MSlcblx0dC5ub3QoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yaygxLCA0LjIsIDQxKVxuXHR0Lm5vdChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG59KVxuXG50YXAudGVzdChcIm9iamVjdCBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbig1KVxuXG5cdGNvbnN0IG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrV2l0aE9iamVjdClcblx0bGV0IGEgPSBtZW1Xb3JrKHthOjF9KVxuXHRsZXQgYiA9IG1lbVdvcmsoe2E6MX0pXG5cblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRiID0gbWVtV29yayh7YjoxfSlcblx0dC5ub3QoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yayh7YToxfSlcblx0dC5ub3QoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSBmYWxzZVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRhID0gbWVtV29yayh7YTozLGI6MixjOjUsZDotMX0pXG5cdGIgPSBtZW1Xb3JrKHthOjMsYjoyLGM6NSxkOi0xfSlcblx0dC5lcXVhbChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIHRydWUgKGNhY2hlZClcIilcblxuXHRtZW1Xb3JrLmZsdXNoKClcdC8vIGNsZWFycyB0aGUgY2FjaGVcblx0YSA9IG1lbVdvcmsoe2E6MyxiOjIsYzo1LGQ6LTF9KVxuXHRiID0gbWVtV29yayh7YTozLGI6MixjOjUsZDoxMDB9KVxuXHR0Lm5vdChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlKVwiKVxufSlcblxudGFwLnRlc3QoXCJhcnJheSBjYWNoaW5nXCIsICh0KSA9PiB7XG5cdHQucGxhbigzKVxuXG5cdGxldCBtZW1Xb3JrID0gbWFrZUNhY2hpbmcod29yaylcblx0bGV0IGEgPSBtZW1Xb3JrLmFwcGx5KG51bGwsIFsxLDIsM10pXG5cdGxldCBiID0gbWVtV29yay5hcHBseShudWxsLCBbMSwyLDNdKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrLmFwcGx5KG51bGwsIFsxLDIsM10pXG5cdHQubm90KGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXG5cdC8qKiBjb250ZXh0IGNhbiBOT1QgYmUgdXNlZCB0byB0cmFuc2Zvcm0gaW5wdXQgKiovXG5cdG1lbVdvcmsgPSBtYWtlQ2FjaGluZyh3b3JrLCB3b3JrKVxuXHRhID0gbWVtV29yayhbMSwyLDNdKVxuXHRiID0gbWVtV29yayhbMSwyLDNdKVxuXG5cdHQubm90KGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2UgLSBOYU4gLSBjb250ZXh0IGNhbiBOT1QgYmUgdXNlZCB0byB0cmFuc2Zvcm0gaW5wdXQgKVwiKVxufSlcblxudGFwLnRlc3QoXCJjb250ZXh0IGNhY2hpbmcgKHByb3RvdHlwZS9vYmplY3QpXCIsICh0KSA9PiB7XG5cdHQucGxhbig2KVxuXG5cdGZ1bmN0aW9uIE15Q2xhc3MoKSB7XG5cdFx0dGhpcy53b3JrID0gd29ya1xuXHR9XG5cdE15Q2xhc3MucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbih2YWx1ZXMpIHtcblx0XHRyZXR1cm4gdGhpcy53b3JrKHZhbHVlcylcblx0fVxuXG5cdGNsYXNzIE15Q2xhc3NTdWdhciB7XG5cdFx0Y29uc3RydWN0b3IoKSB7XG5cdFx0XHR0aGlzLndvcmsgPSB3b3JrXG5cdFx0fVxuXHRcdGV4ZWN1dGUodmFsdWVzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy53b3JrKHZhbHVlcylcblx0XHR9XG5cdH1cblxuXHRjb25zdCBteU9iamVjdCA9IHtcblx0XHR3b3JrLFxuXHRcdGV4ZWN1dGUodmFsdWVzKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy53b3JrKHZhbHVlcylcblx0XHR9XG5cdH1cblxuXHQvKiogcHJvdG90eXBhbCBjb250ZXh0ICoqL1xuXHRjb25zdCBteUNsYXNzID0gbmV3IE15Q2xhc3Ncblx0bGV0IG1lbVdvcmsgPSBtYWtlQ2FjaGluZyhteUNsYXNzLmV4ZWN1dGUsIG15Q2xhc3MpXG5cdGxldCBhID0gbWVtV29yaygxKVxuXHRsZXQgYiA9IG1lbVdvcmsoMSlcblxuXHR0LmVxdWFsKGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgdHJ1ZSAoY2FjaGVkKVwiKVxuXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXHRiID0gbWVtV29yaygxKVxuXHR0Lm5vdChhLCBiLCBcImEgPT09IGIgc2hvdWxkIGJlIGZhbHNlXCIpXG5cblxuXHQvKiogY2xhc3MgcHJvdG90eXBhbCBjb250ZXh0ICoqL1xuXHRjb25zdCBteUNsYXNzU3VnYXIgPSBuZXcgTXlDbGFzc1N1Z2FyXG5cdG1lbVdvcmsgPSBtYWtlQ2FjaGluZyhteUNsYXNzU3VnYXIuZXhlY3V0ZSwgbXlDbGFzc1N1Z2FyKVxuXHRhID0gbWVtV29yaygxKVxuXHRiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cblx0bWVtV29yay5mbHVzaCgpXHQvLyBjbGVhcnMgdGhlIGNhY2hlXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90KGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcblxuXG5cdC8qKiBvYmplY3QgY29udGV4dCAqKi9cblx0bWVtV29yayA9IG1ha2VDYWNoaW5nKG15T2JqZWN0LmV4ZWN1dGUsIG15T2JqZWN0KVxuXHRhID0gbWVtV29yaygxKVxuXHRiID0gbWVtV29yaygxKVxuXG5cdHQuZXF1YWwoYSwgYiwgXCJhID09PSBiIHNob3VsZCBiZSB0cnVlIChjYWNoZWQpXCIpXG5cdG1lbVdvcmsuZmx1c2goKVx0Ly8gY2xlYXJzIHRoZSBjYWNoZVxuXG5cdGIgPSBtZW1Xb3JrKDEpXG5cdHQubm90KGEsIGIsIFwiYSA9PT0gYiBzaG91bGQgYmUgZmFsc2VcIilcbn0pXG4iXX0=